models:
  - name: stg_locations
    description: List of open locations with basic cleaning and transformation applied, one row per location.
    meta:
      sst:
        cortex_searchable: false
        synonyms:
          - open location list
          - active store locations
          - currently open stores
          - operational location details
        primary_key: location_id

    columns:
      - name: location_id
        description: The unique key for each location.
        data_tests:
          - not_null
          - unique

        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            synonyms:
              - location identifier
              - store ID
              - location key
              - unique location code
            sample_values:
              - 1ce7ac35-d296-4e34-89c4-bf92aa2fe751
              - 39b38c24-679d-4217-b676-a4a0e64c8477
              - 09fdfbaf-3ec6-408d-93f4-1efc535d9938
              - 4b6c2304-2b9e-41e4-942a-cf11a1819378
              - 40e6ddd6-b8f6-4e17-8bd6-5e53966809d2
              - da506490-1e2f-4fe8-8426-f1eee65af28a
            is_enum: true

      - name: location_name
        description: The name of the location (typically the city name).
        meta:
          sst:
            column_type: dimension
            data_type: TEXT
            synonyms:
              - store name
              - location title
              - city name
              - store location
            sample_values:
              - San Francisco
              - Los Angeles
              - New Orleans
              - Brooklyn
              - Chicago
              - Philadelphia
            is_enum: true

      - name: tax_rate
        description: The sales tax rate for this location (as a decimal, e.g., 0.06 for 6%).
        meta:
          sst:
            column_type: fact
            data_type: FLOAT
            synonyms:
              - tax percentage
              - sales tax rate
              - tax amount
              - tax value
            sample_values:
              - '0.06'
              - '0.0625'
              - '0.04'
              - '0.075'
              - '0.08'
            is_enum: false

      - name: opened_date
        description: The date when this location was opened.
        meta:
          sst:
            column_type: time_dimension
            data_type: TIMESTAMP_NTZ
            synonyms:
              - opening date
              - store opening
              - date opened
              - launch date
            sample_values:
              - '2016-09-01 00:00:00'
              - '2019-03-10 00:00:00'
              - '2018-05-09 00:00:00'
              - '2019-09-13 00:00:00'
              - '2017-03-12 00:00:00'
              - '2018-04-29 00:00:00'
            is_enum: false
unit_tests:
  - name: test_does_location_opened_at_trunc_to_date
    description: "Check that opened_at timestamp is properly truncated to a date."
    model: stg_locations
    given:
      - input: source('ecom', 'raw_stores')
        rows:
          - {id: 1, name: "Vice City", tax_rate: 0.2, opened_at: "2016-09-01T00:00:00"}
          - {id: 2, name: "San Andreas", tax_rate: 0.1, opened_at: "2079-10-27T23:59:59.9999"}
    expect:
      rows:
        - {location_id: 1, location_name: "Vice City", tax_rate: 0.2, opened_date: "2016-09-01"}
        - {location_id: 2, location_name: "San Andreas", tax_rate: 0.1, opened_date: "2079-10-27"}
