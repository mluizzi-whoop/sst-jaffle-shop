snowflake_relationships:
  # Standard equality relationships (existing)
  - name: orders_to_customers
    left_table: {{ table('orders') }}
    right_table: {{ table('customers') }}
    relationship_conditions:
      - "{{ column('orders', 'customer_id') }} = {{ column('customers', 'customer_id') }}"

  - name: order_items_to_orders
    left_table: {{ table('order_items') }}
    right_table: {{ table('orders') }}
    relationship_conditions:
      - "{{ column('order_items', 'order_id') }} = {{ column('orders', 'order_id') }}"

  - name: order_items_to_products
    left_table: {{ table('order_items') }}
    right_table: {{ table('products') }}
    relationship_conditions:
      - "{{ column('order_items', 'product_id') }} = {{ column('products', 'product_id') }}"

  - name: orders_to_locations
    left_table: {{ table('orders') }}
    right_table: {{ table('locations') }}
    relationship_conditions:
      - "{{ column('orders', 'location_id') }} = {{ column('locations', 'location_id') }}"

  # ASOF relationship: Orders to Locations by time
  # Use case: Join orders to locations that were open at the time of order
  # Only matches if order_date >= location opened_date
  - name: orders_to_locations_asof
    left_table: {{ table('orders') }}
    right_table: {{ table('locations') }}
    relationship_conditions:
      # Equality on location_id
      - "{{ column('orders', 'location_id') }} = {{ column('locations', 'location_id') }}"
      # ASOF: Order date >= location opened date
      - "{{ column('orders', 'ordered_at') }} >= {{ column('locations', 'opened_date') }}"

  # ASOF relationship: Orders to Customers by time
  # Use case: Find customer state at or before order time
  # Joins orders to customers where order date >= customer's first order date
  - name: orders_to_customers_asof
    left_table: {{ table('orders') }}
    right_table: {{ table('customers') }}
    relationship_conditions:
      # Equality on customer_id
      - "{{ column('orders', 'customer_id') }} = {{ column('customers', 'customer_id') }}"
      # ASOF: Order date >= customer's first order date
      - "{{ column('orders', 'ordered_at') }} >= {{ column('customers', 'first_ordered_at') }}"